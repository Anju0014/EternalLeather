

<!-- <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">Checkout</h1>

 
    <form action="/user/checkout" method="POST" id="checkout-form">
    

             <div class="flex justify-between">
            <div class="bg-white p-6 rounded-md shadow-md">
                <h2 class="text-xl font-bold mb-4">Select Delivery Address</h2>
            
              <div class="container mx-auto p-6">
                <% if (addresses && addresses.length > 0) { %>
                    <% addresses.forEach((address, index) => { %>
                        <div class="flex items-start justify-between bg-white p-4 mb-4 rounded-md shadow-md">
                           

                            <input type="radio" id="address<%= index %>" name="selectedAddress" value="<%= address._id %>" class="mr-4 mt-2" <%= index === 0 ? 'checked' : '' %> />
            
                           

                            <div class="flex-grow">
                                <p class="font-semibold text-lg"><%= address.contactname %></p>
                                <p><%= address.building %>, <%= address.street %></p>
                                <p><%= address.city %>, <%= address.state %>, <%= address.country %>, <%= address.pincode %></p>
                                <p>Landmark: <%= address.landMark %></p>
                                <p>Phone: <%= address.phoneno %></p>
                            </div>
            
                     
                        </div>
                    <% }); %>
                <% } else { %>
                    <p class="text-gray-500">No addresses found. Please add a new address.</p>
                <% } %>
            </div>
            
                <a href="/user/profile" class="text-blue-500 hover:underline">Manage Addresses</a>
            </div>
            
           

            <div class="bg-white p-6 rounded-md shadow-md">
                <h2 class="text-xl font-bold mb-4">Cart Summary</h2>
                 <h3 class="hidden" id="cartId"><%=cart._id %></h3>
                <% cart.items.forEach(item => { %>
                    <div class="flex justify-between mb-4">
                        <span class="font-semibold text-gray-800"><%= item.productId.productName %></span>
                        <span class="font-semibold text-gray-800">$<%= item.discountPrice %> x <%= item.productCount %></span>
                    </div>
                <% }) %>

                <hr class="my-4">

                <div class="flex justify-between text-lg font-bold">
                    <span>Total Payable</span>
                    <span>$<%= cart.payablePrice %></span>
                </div>
            </div>
<div>


        <div class="bg-white p-6 rounded-md shadow-md mt-6">
            <h2 class="text-xl font-bold mb-4">Select Payment Method</h2>
            
            
            <div class="mb-4">
                <div>
                <input type="radio" id="cashOnDelivery" name="paymentMethod" value="Cash On Delivery" checked>
                <label for="cashOnDelivery" class="ml-2 text-gray-700">Cash on Delivery</label></div>
                <a href="#" class="bg-red-300 border border-y-2 text-yellow-100">Pay here</button> </a>
            </div>

            <div class="mb-4">
                <div>
                <input type="radio" id="bankTransfer" name="paymentMethod" value="bankTransfer">
                <label for="bankTransfer" class="ml-2 text-gray-700">Wallet</label></div>
                <a href="#" class="bg-red-300 border border-y-2 text-yellow-100">Pay here</button> </a>
            </div>

            <div class="mb-4">
                <div>
                <input type="radio" id="razorpay" name="paymentMethod" value="razorpay">
                <label for="razorpay" class="ml-2 text-gray-700">Razorpay</label>
                </div>
                <a href="#" class="bg-red-300 border border-y-2 text-yellow-100">Pay here</button> </a>
            </div>
        
            </div>
    

        <div class="mt-6">
            <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-md font-bold hover:bg-blue-600">
                Place Order
            </button>
        </div>

        </div>
        </div>
    </form>
</div>
</div>


<div id="orderConfirmationModal" class="fixed inset-0 z-50 hidden bg-gray-900 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-lg max-w-lg w-1/3 p-6">
      <div class="text-center">
        <h2 class="text-2xl font-semibold text-gray-800">Order Confirmed!</h2>
        <p class="mt-4 text-gray-600">Your order has been confirmed successfully.</p>
        <button id="closeModal" class="mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none">Close</button>
      </div>
    </div>
  </div>
   -->




<!-- 
   <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">Checkout</h1>

    <form action="/user/checkout" method="POST" id="checkout-form" class="flex flex-col space-y-6">
        
     
        <div class="bg-white p-6 rounded-md shadow-md">
            <h2 class="text-xl font-bold mb-4">Select Delivery Address</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <% if (addresses && addresses.length > 0) { %>
                    <% addresses.forEach((address, index) => { %>
                        <div class="flex items-start justify-between bg-gray-100 p-4 rounded-md shadow">
                            <input type="radio" id="address<%= index %>" name="selectedAddress" value="<%= address._id %>" class="mr-4 mt-2" <%= index === 0 ? 'checked' : '' %> />
                            <div class="flex-grow">
                                <p class="font-semibold text-lg"><%= address.contactname %></p>
                                <p><%= address.building %>, <%= address.street %></p>
                                <p><%= address.city %>, <%= address.state %>, <%= address.country %>, <%= address.pincode %></p>
                                <p>Landmark: <%= address.landMark %></p>
                                <p>Phone: <%= address.phoneno %></p>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <p class="text-gray-500">No addresses found. Please add a new address.</p>
                <% } %>
            </div>
            <a href="/user/profile" class="text-blue-500 hover:underline mt-4 block">Manage Addresses</a>
        </div>

        <div class="bg-white p-6 rounded-md shadow-md">
            <h2 class="text-xl font-bold mb-4">Cart Summary</h2>
            <% cart.items.forEach(item => { %>
                <div class="flex justify-between mb-4">
                    <span class="font-semibold text-gray-800"><%= item.productId.productName %></span>
                    <span class="font-semibold text-gray-800">$<%= item.discountPrice %> x <%= item.productCount %></span>
                </div>
            <% }) %>
            <hr class="my-4">
            <div class="flex justify-between text-lg font-bold">
                <span>Total Payable</span>
                <span>$<%= cart.payablePrice %></span>
            </div>
        </div>


        <div class="bg-white p-6 rounded-md shadow-md">
            <h2 class="text-xl font-bold mb-4">Select Payment Method</h2>
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="radio" id="cashOnDelivery" name="paymentMethod" value="Cash On Delivery" checked>
                        <label for="cashOnDelivery" class="ml-2 text-gray-700">Cash on Delivery</label>
                    </div>
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="handlePayNow('Cash On Delivery')">Pay Now</button>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="radio" id="bankTransfer" name="paymentMethod" value="bankTransfer">
                        <label for="bankTransfer" class="ml-2 text-gray-700">Wallet</label>
                    </div>
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="handlePayNow('Wallet')">Pay Now</button>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="radio" id="razorpay" name="paymentMethod" value="razorpay">
                        <label for="razorpay" class="ml-2 text-gray-700">Razorpay</label>
                    </div>
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="handlePayNow('Razorpay')">Pay Now</button>
                </div>
            </div>
        </div>

        <div class="mt-6">
            <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-md font-bold hover:bg-blue-600">
                Place Order
            </button>
        </div>
    </form>
   </div>

   <div id="orderConfirmationModal" class="fixed inset-0 z-50 hidden bg-gray-900 bg-opacity-50 flex items-center justify-center"></div>
   <div class="bg-white rounded-lg shadow-lg max-w-lg w-1/3 p-6">
     <div class="text-center">
       <h2 class="text-2xl font-semibold text-gray-800">Order Confirmed!</h2>
       <p class="mt-4 text-gray-600">Your order has been confirmed successfully.</p>
       <button id="closeModal" class="mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none">Close</button>
     </div>
   </div>
 </div>
   

</div> -->



<div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">Checkout</h1>

    <form action="/user/checkout" method="POST" id="checkout-form" class="flex flex-col space-y-6">
        
        <!-- Select Delivery Address -->
        <div class="bg-white p-6 rounded-md shadow-md">
            <h2 class="text-xl font-bold mb-4">Select Delivery Address</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <% if (addresses && addresses.length > 0) { %>
                    <% addresses.forEach((address, index) => { %>
                        <div class="flex items-start justify-between bg-gray-100 p-4 rounded-md shadow">
                            <input type="radio" id="address<%= index %>" name="selectedAddress" value="<%= address._id %>" class="mr-4 mt-2" <%= index === 0 ? 'checked' : '' %> />
                            <div class="flex-grow">
                                <p class="font-semibold text-lg"><%= address.contactname %></p>
                                <p><%= address.building %>, <%= address.street %></p>
                                <p><%= address.city %>, <%= address.state %>, <%= address.country %>, <%= address.pincode %></p>
                                <p>Landmark: <%= address.landMark %></p>
                                <p>Phone: <%= address.phoneno %></p>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <p class="text-gray-500">No addresses found. Please add a new address.</p>
                <% } %>
            </div>
            <a href="/user/profile" class="text-blue-500 hover:underline mt-4 block">Manage Addresses</a>
        </div>

        <!-- Cart Summary -->
        <div class="bg-white p-6 rounded-md shadow-md">
            <h2 class="text-xl font-bold mb-4">Cart Summary</h2>
            <% cart.items.forEach(item => { %>
                <div class="flex justify-between mb-4">
                    <span class="font-semibold text-gray-800"><%= item.productId.productName %></span>
                    <span class="font-semibold text-gray-800">$<%= item.discountPrice %> x <%= item.productCount %></span>
                </div>
            <% }) %>
            <hr class="my-4">
            <div class="flex justify-between text-lg font-bold">
                <span>Total Payable</span>
                <span>$<%= cart.payablePrice %></span>
            </div>
        </div>

        <!-- Payment Method -->
        <div class="bg-white p-6 rounded-md shadow-md">
            <h2 class="text-xl font-bold mb-4">Select Payment Method</h2>
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="radio" id="cashOnDelivery" name="paymentMethod" value="Cash On Delivery" checked>
                        <label for="cashOnDelivery" class="ml-2 text-gray-700">Cash on Delivery</label>
                    </div>
                    <button type="button" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="handlePayNow('Cash On Delivery')">Pay Now</button>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="radio" id="bankTransfer" name="paymentMethod" value="bankTransfer">
                        <label for="bankTransfer" class="ml-2 text-gray-700">Wallet</label>
                    </div>
                    <button type="button" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="handlePayNow('Wallet')">Pay Now</button>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="radio" id="razorpay" name="paymentMethod" value="razorpay">
                        <label for="razorpay" class="ml-2 text-gray-700">Razorpay</label>
                    </div>
                    <button type="button" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="handlePayNow('Razorpay')">Pay Now</button>
                </div>
            </div>
        </div>

        <!-- Place Order Button -->
        <div class="mt-6">
            <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-md font-bold hover:bg-blue-600">
                Place Order
            </button>
        </div>
    </form>
</div>

<!-- Modal Structure -->
<div id="orderConfirmationModal" class="fixed inset-0 z-50 hidden bg-gray-900 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-lg max-w-lg w-1/3 p-6">
        <div class="text-center">
            <h2 class="text-2xl font-semibold text-gray-800">Order Confirmed!</h2>
            <p class="mt-4 text-gray-600">Your order has been confirmed successfully.</p>
            <button id="closeModal" class="mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none">Close</button>
        </div>
    </div>
</div>

<script>
    // Function to show the modal
    function showModal() {
        document.getElementById("orderConfirmationModal").classList.remove("hidden");
    }

    // Close modal when the "Close" button is clicked
    document.getElementById("closeModal").addEventListener("click", function() {
        document.getElementById("orderConfirmationModal").classList.add("hidden");
    });

    // Handle payment and show modal
    function handlePayNow(method) {
        alert(`Proceeding to payment with: ${method}`);
        // You can add your payment processing logic here

        // Show the confirmation modal after handling payment
        showModal();
    }
</script>


<script>
    document.getElementById('checkout-form').addEventListener('submit', async function (e) {
        e.preventDefault();
          
        console.log("ooo")
        // Get selected address index
        const selectedAddress = document.querySelector('input[name="selectedAddress"]:checked').value;
        
        // Get selected payment method
        const selectedPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
        
        // Fetch order data from the cart (you might get this from a hidden input or a global variable)
        const cartId = '<%= cart._id %>';
        // Prepare the data to send to the server
        const formData = {
            selectedAddress: selectedAddress,
            paymentMethod: selectedPaymentMethod,
            cartId:cartId,
        };

        // Send the data using fetch API
        const response = await fetch('/user/checkout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
        });

        const result = await response.json();

        if (result.success) {
            const modal = document.getElementById('orderConfirmationModal');
    modal.classList.remove('hidden');

    // Add event listener to close the modal
    document.getElementById('closeModal').addEventListener('click', function() {
        // Hide the modal
        modal.classList.add('hidden');

        // Redirect to the order summary page after closing the modal
        window.location.href = '/user/order/summary';
    });
            // // Redirect to the order confirmation page
            // window.location.href = '/user/order/summary';
        } else {
            alert(result.message);
        }
    });
    function handlePayNow(method) {
        alert(`Proceeding to payment with: ${method}`);
        // You can add your payment processing logic here

        // Show the confirmation modal after handling payment
        showModal();
    }
</script>
